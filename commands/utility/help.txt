const { SlashCommandBuilder, EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle } = require("discord.js");
const fs = require("fs");
const path = require("path");

module.exports = {
    data: new SlashCommandBuilder()
        .setName("help")
        .setDescription("Shows all bot commands organized by category."),

    async execute(interaction) {
        const commandsPath = path.join(__dirname, "..");
        const categories = ["fun", "moderation", "utility", "suggestion", "music"];
        const embed = new EmbedBuilder()
            .setTitle("ðŸ“š Bot Commands")
            .setColor("Grey")
            .setDescription("Heree are the available commands organized by category:");

        for (const category of categories) {
            const categoryPath = path.join(commandsPath, category);
            let commandNames = [];
            if (fs.existsSync(categoryPath)) {
                const files = fs.readdirSync(categoryPath).filter(f => f.endsWith(".js"));
                commandNames = files.map(f => f.replace(".js", ""));
            }
            embed.addFields({
                name: `ðŸ—‚ ${category.charAt(0).toUpperCase() + category.slice(1)}`,
                value: commandNames.length > 0 ? commandNames.join(", ") : "None",
                inline: false
            });
        }

        const row = new ActionRowBuilder().addComponents(
            new ButtonBuilder()
                .setCustomId("show_all_commands")
                .setLabel("Show All Commands")
                .setStyle(ButtonStyle.Secondary)
        );

        await interaction.reply({ embeds: [embed], components: [row], ephemeral: true });

        // Button interaction
        const collector = interaction.channel.createMessageComponentCollector({ time: 60000 });
        collector.on("collect", async i => {
            if (i.customId === "show_all_commands") {
                const allCommands = [];
                for (const category of categories) {
                    const categoryPath = path.join(commandsPath, category);
                    if (fs.existsSync(categoryPath)) {
                        const files = fs.readdirSync(categoryPath).filter(f => f.endsWith(".js"));
                        files.forEach(f => allCommands.push(`${f.replace(".js", "")} (${category})`));
                    }
                }

                const allEmbed = new EmbedBuilder()
                    .setTitle("ðŸ“‹ All Commands")
                    .setColor("Grey")
                    .setDescription(allCommands.length > 0 ? allCommands.join(", ") : "No commands found");

                await i.update({ embeds: [allEmbed], components: [] });
            }
        });
    }
};
